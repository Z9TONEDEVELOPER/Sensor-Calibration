<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:CalibrationApp.ViewModels"
        xmlns:v="using:CalibrationApp.Views"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        d:DesignWidth="1600" 
        d:DesignHeight="900"
        x:Class="CalibrationApp.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Calibra - ÐÐ½Ð°Ð»Ð¸Ð·Ð°Ñ‚Ð¾Ñ€ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐµÐ½ÑÐ¾Ñ€Ð¾Ð²">
        
    <!-- Design-time DataContext removed (MainWindowViewModel requires services). DataContext is set at runtime in App.axaml.cs -->

    <Grid RowDefinitions="Auto,*" ColumnDefinitions="300,*">
        <!-- ÐœÐµÐ½ÑŽ -->
        <Menu Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2">
            <MenuItem Header="_Ð¤Ð°Ð¹Ð»">
                <MenuItem Header="_Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ" Command="{Binding LoadDataCommand}"/>
                <MenuItem Header="_Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…" Command="{Binding ExportDataCommand}"/>
                <MenuItem Header="_Ð’Ñ‹Ñ…Ð¾Ð´" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="_ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°">
                <MenuItem Header="_ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ" Command="{Binding ProcessDataCommand}"/>
                <MenuItem Header="_Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹"/>
            </MenuItem>
            <MenuItem Header="_Ð’Ð¸Ð´">
                <MenuItem Header="_Ð¢ÐµÐ¼Ð½Ð°Ñ Ñ‚ÐµÐ¼Ð°"/>
                <MenuItem Header="_Ð¡Ð²ÐµÑ‚Ð»Ð°Ñ Ñ‚ÐµÐ¼Ð°"/>
            </MenuItem>
            <MenuItem Header="_Ð¡Ð¿Ñ€Ð°Ð²ÐºÐ°">
                <MenuItem Header="_Ðž Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ðµ"/>
            </MenuItem>
        </Menu>
        
        <!-- Ð›ÐµÐ²Ð°Ñ Ð¿Ð°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ -->
        <ScrollViewer Grid.Row="1" Grid.Column="0" 
                      VerticalScrollBarVisibility="Auto" 
                      HorizontalScrollBarVisibility="Disabled">
            <StackPanel Spacing="10" Margin="10">
                <!-- Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… -->
                <Button Name="LoadDataButton" Content="ðŸ“‚ Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ" 
                        Command="{Binding LoadDataCommand}"
                        Height="40" 
                        FontSize="14" 
                        FontWeight="Bold"
                        Background="#0d7377" 
                        Foreground="White"/>
                
                <!-- ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ (Ð·Ð°Ð¼ÐµÐ½Ð° GroupBox Ð½Ð° Border + Header) -->
                <Border BorderBrush="#3f3f46" BorderThickness="1" CornerRadius="4" Padding="6">
                    <StackPanel>
                        <TextBlock Text="ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸" FontWeight="Bold" Margin="4"/>
                        <StackPanel Spacing="10" Margin="0,6,0,0">
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <TextBlock Text="ÐžÐºÐ½Ð¾ ÑÐ³Ð»Ð°Ð¶Ð¸Ð²Ð°Ð½Ð¸Ñ:" Width="130" VerticalAlignment="Center"/>
                                <NumericUpDown Value="{Binding WindowSize}" 
                                              Minimum="1" Maximum="50" 
                                              Width="80"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <TextBlock Text="ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ LOWESS:" Width="130" VerticalAlignment="Center"/>
                                <Slider Value="{Binding LowessFraction}" 
                                       Minimum="0.01" Maximum="0.5" 
                                       TickFrequency="0.01" 
                                       Width="150"/>
                                <TextBlock Text="{Binding LowessFraction, StringFormat={}{0:F2}}" 
                                          Width="40" 
                                          TextAlignment="Center" 
                                          VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <TextBlock Text="ÐŸÐ¾Ñ€Ð¾Ð³ Ð²Ñ‹Ð±Ñ€Ð¾ÑÐ¾Ð²:" Width="130" VerticalAlignment="Center"/>
                                <Slider Value="{Binding OutlierThreshold}" 
                                       Minimum="1.0" Maximum="10.0" 
                                       TickFrequency="0.5" 
                                       Width="150"/>
                                <TextBlock Text="{Binding OutlierThreshold, StringFormat={}{0:F1}}" 
                                          Width="40" 
                                          TextAlignment="Center" 
                                          VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <TextBlock Text="ÐœÐµÑ‚Ð¾Ð´ Ð²Ñ‹Ð±Ñ€Ð¾ÑÐ¾Ð²:" Width="130" VerticalAlignment="Center"/>
                                <ComboBox ItemsSource="{Binding OutlierMethods}" 
                                         SelectedItem="{Binding OutlierMethod}" 
                                         Width="150"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <TextBlock Text="Ð¢Ð¸Ð¿ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°:" Width="130" VerticalAlignment="Center"/>
                                <ComboBox ItemsSource="{Binding FilterTypes}" 
                                         SelectedItem="{Binding FilterType}" 
                                         Width="150"/>
                            </StackPanel>
                            
                            <Button Content="âš™ï¸ ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ" 
                                    Command="{Binding ProcessDataCommand}"
                                    Height="40" 
                                    FontWeight="Bold"
                                    Background="#4e4376" 
                                    Foreground="White"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <!-- ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÐºÐ°Ð»Ð¸Ð±Ñ€Ð¾Ð²ÐºÐ¸ (Ð·Ð°Ð¼ÐµÐ½Ð° GroupBox) -->
                <Border BorderBrush="#3f3f46" BorderThickness="1" CornerRadius="4" Padding="6">
                    <StackPanel>
                        <TextBlock Text="ÐšÐ°Ð»Ð¸Ð±Ñ€Ð¾Ð²ÐºÐ°" FontWeight="Bold" Margin="4"/>
                        <StackPanel Spacing="10" Margin="0,6,0,0">
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <TextBlock Text="Ð¡ÐµÐ½ÑÐ¾Ñ€:" Width="130" VerticalAlignment="Center"/>
                                <NumericUpDown Value="{Binding CurrentSensor}" 
                                              Minimum="1" Maximum="8" 
                                              Width="80"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <TextBlock Text="ÐœÐµÑ‚Ð¾Ð´ ÐºÐ°Ð»Ð¸Ð±Ñ€Ð¾Ð²ÐºÐ¸:" Width="130" VerticalAlignment="Center"/>
                                <ComboBox ItemsSource="{Binding CalibrationMethods}" 
                                         SelectedItem="{Binding CalibMethod}" 
                                         Width="150"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <!-- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ñ… (Ð·Ð°Ð¼ÐµÐ½Ð° GroupBox) -->
                <Border BorderBrush="#3f3f46" BorderThickness="1" CornerRadius="4" Padding="6">
                    <StackPanel>
                        <TextBlock Text="Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ñ…" FontWeight="Bold" Margin="4"/>
                        <StackPanel Spacing="5" Margin="10">
                            <TextBlock Text="Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:" FontWeight="Bold"/>
                            <TextBlock Text="{Binding StatusMessage}" Foreground="#9cdcfe"/>
                            <ProgressBar IsVisible="{Binding IsProcessing}" IsIndeterminate="{Binding IsProcessing}" Height="8" />
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <!-- Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ (Ð·Ð°Ð¼ÐµÐ½Ð° GroupBox) -->
                <Border BorderBrush="#3f3f46" BorderThickness="1" CornerRadius="4" Padding="6">
                    <StackPanel>
                        <TextBlock Text="Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ" FontWeight="Bold" Margin="4"/>
                        <StackPanel Spacing="5" Margin="10">
                            <Button Content="ðŸ” ÐŸÐ¾Ð¸ÑÐº Ð°Ð½Ð¾Ð¼Ð°Ð»Ð¸Ð¹" Height="30" Background="#0d7377" Foreground="White"/>
                            <Button Content="ðŸ“Š Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð°" Height="30" Background="#4e4376" Foreground="White"/>
                            <Button Content="ðŸ”„ Ð¡Ð±Ñ€Ð¾Ñ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²" Height="30" Background="#7a3a5c" Foreground="White"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
        
        <!-- ÐŸÑ€Ð°Ð²Ð°Ñ Ð¿Ð°Ð½ÐµÐ»ÑŒ Ñ Ð²ÐºÐ»Ð°Ð´ÐºÐ°Ð¼Ð¸ -->
        <TabControl Grid.Row="1" Grid.Column="1" Margin="10,10,10,10">
            <TabItem Header="ðŸ“Š Ð“Ñ€Ð°Ñ„Ð¸ÐºÐ¸">
                <Grid RowDefinitions="*,*">
                    <v:PlotView Grid.Row="0" 
                                x:Name="RawPlotView" 
                                DataContext="{Binding RawPlotViewModel}"/>
                    <v:PlotView Grid.Row="1" 
                                x:Name="CalibPlotView" 
                                DataContext="{Binding CalibPlotViewModel}" 
                                Margin="0,10,0,0"/>
                </Grid>
            </TabItem>
            
            <TabItem Header="ðŸ“ˆ Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°">
                <!-- Ð—Ð°Ð¼ÐµÐ½Ð¸Ð» DataGrid Ð½Ð° ListBox Ñ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ð¼ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð¾Ð¼ -->
                <ListBox ItemsSource="{Binding SensorStatistics}" Background="#1e1e1e" Foreground="#d4d4d4">
                    <ListBox.ItemTemplate>
                        <DataTemplate x:DataType="vm:SensorStat">
                            <Border Padding="6" BorderBrush="#2a2a2a" BorderThickness="0,0,0,1">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Width="60" Text="{Binding SensorNumber}"/>
                                    <TextBlock Width="90" Text="{Binding Mean, StringFormat={}{0:F4}}"/>
                                    <TextBlock Width="90" Text="{Binding Median, StringFormat={}{0:F4}}"/>
                                    <TextBlock Width="90" Text="{Binding StdDev, StringFormat={}{0:F4}}"/>
                                    <TextBlock Width="70" Text="{Binding Min, StringFormat={}{0:F4}}"/>
                                    <TextBlock Width="70" Text="{Binding Max, StringFormat={}{0:F4}}"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                     </ListBox.ItemTemplate>
                 </ListBox>
            </TabItem>
            
            <TabItem Header="ðŸ”„ Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ">
                <v:PlotView x:Name="ComparisonPlotView" DataContext="{Binding ComparisonPlotViewModel}"/>
            </TabItem>
        </TabControl>
    </Grid>
</Window>